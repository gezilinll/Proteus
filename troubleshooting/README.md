# Troubleshooting 踩坑指南

本目录记录 Proteus 项目开发过程中遇到的实际问题及其解决方案，帮助开发者避免重复踩坑。

## 什么问题应该记录？

### 核心判断标准

一个问题是否值得记录，需要同时满足以下条件：

1. **普遍性**：其他开发者或用户也可能遇到同样的问题
2. **外部因素**：问题由环境、依赖、浏览器差异等外部因素导致，而非个人编码疏忽
3. **可复用性**：解决方案具有参考价值，可以帮助他人快速解决类似问题

### ✅ 应该记录的问题类型

| 类型 | 示例 | 说明 |
|------|------|------|
| **环境/配置问题** | jsdom 27 ESM 模块兼容性 | 测试环境、构建工具配置导致的问题 |
| **依赖兼容性** | ESLint 9 配置迁移 | 版本升级带来的 breaking change |
| **平台/浏览器差异** | Canvas DPR 模糊 | 不同设备、浏览器的行为差异 |
| **性能问题** | 渲染循环导致 CPU 占用过高 | 需要特定优化策略的性能瓶颈 |
| **API 陷阱** | Canvas ellipse() vs arc() | 官方 API 的非直观行为 |

### ❌ 不应该记录的问题类型

| 类型 | 示例 | 更合适的归属 |
|------|------|-------------|
| **个人编码疏忽** | 忘记使用 deepClone 导致数据共享 | 代码注释、Code Review 清单 |
| **业务逻辑设计细节** | Command 撤销时需要恢复元素位置 | 架构设计文档 |
| **TypeScript 类型错误** | `'xxx' is declared but never used` | 编译时可发现，无需记录 |
| **ESLint 规则违规** | `no-undef`, `rules-of-hooks` | 静态检查可发现，无需记录 |
| **简单拼写/语法错误** | 变量名拼错 | 无学习价值，无需记录 |

### 判断流程图

```
遇到问题 → 问自己：
  │
  ├─ "其他开发者也可能遇到吗？" 
  │     └─ 否 → 不记录（个人疏忽）
  │
  ├─ "是外部因素导致的吗？"
  │     └─ 否 → 不记录（业务逻辑细节，放设计文档）
  │
  └─ "解决方案对他人有参考价值吗？"
        └─ 否 → 不记录（太特殊，无复用性）
        └─ 是 → ✅ 记录
```

---

## 问题分类

| 分类 | 描述 | 目录 |
|------|------|------|
| 测试 | 测试环境配置、测试框架问题 | `testing/` |
| 渲染 | Canvas 渲染、视觉表现问题 | `rendering/` |
| 依赖 | 依赖版本兼容性、升级问题 | `dependencies/` |
| 性能 | 性能瓶颈、优化策略 | `performance/` |
| 交互 | 拖拽、事件处理问题 | `interaction/` |
| 浏览器兼容性 | 跨浏览器差异问题 | `browser-compatibility/` |

---

## 问题索引

### 测试相关
- [jsdom 27 ESM 模块兼容性问题](./testing/jsdom-esm-compatibility.md)

### 渲染相关
- [Canvas 高分辨率屏幕模糊问题 (DPR)](./rendering/canvas-dpr-blurry.md)
- [CSS line-height 与 Canvas textBaseline 的渲染差异](./rendering/css-canvas-text-baseline-diff.md)

### 依赖相关
- [ESLint 9 Flat Config 迁移](./dependencies/eslint9-flat-config-migration.md)

### 交互相关
- [拖拽指示线闪烁导致 Drop 失效](./interaction/drag-indicator-flicker.md)

---

## 文档模板

遇到符合标准的新问题并解决后，请按以下模板添加文档：

```markdown
# [问题标题]

## 现象
- 具体表现是什么
- 错误信息/截图

## 环境
- 相关版本信息
- 触发条件

## 原因分析
- 根本原因是什么
- 为什么会发生

## 解决方案
- 具体修复步骤
- 代码变更

## 延伸知识
- 相关技术背景
- 类似问题的预防方法

## 参考
- 相关链接/Issue
```

---

## 贡献指南

1. 确认问题符合上述判断标准
2. 在对应分类目录下创建 markdown 文件
3. 按模板填写完整信息
4. 更新本文件的"问题索引"部分
5. 提交 PR
